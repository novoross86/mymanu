# mymanu
Сервис qr меню на  python django. 

Приветствуется реализация описанных функций сервиса за счет внедрения уже готовых решений и библиотек.
Например 
функции тестирование существует несколько готовых проектов с открытым исходным кодом:

https://github.com/Vadim-Karpenko/django-AB-project

https://github.com/johnboxall/django-ab

функция кэширования либо стандартная либо redis и т.д.

Данный функционал необходимо реализовать на базе нового Django приложения в общем проекте к примеру analiz.

Задача сервиса это повышение среднего чека, конверсии карточек маржинальных товаров и метрик путем постоянного тестирования новых фитчей и возврат пользователя.

Экраны приложения:

Dish – карточка товара

Dish – страница товара

Plасе - главный экран меню

Basket – корзина товара


Таблицы проекта:

User пользователи

Place заведения

Dishes блюда 

Category категории блюд

Basket корзины заказов

FeatureTest результаты тестов

Feature фитчи


Добавить в таблицу Dish
Количество показов карточки
Маржинальность
Вероятность покупки
Вероятность перехода
Рейтинг по чеку
Рейтинг по прибыли
Время приготовления

Авторизация через почту и телефон
Добавить в систему авторизации функцию подтверждения учётной записи через электронную почту.


Восстановление пароля
Добавить в систему авторизации функцию восстановления пароля пользователя через электронную почту


Правка url по слагу
Изменить метод формирования ссылки, заменить id на мест на слаги 


Создание qr кодов
В панели модератора сделать раздел для формирования qr кодов для заведения.
Модератору необходимо будет указать количество столов и при необходимости дать маленькое изображение для размещения в центре qr кода.
Функция должна выдать страницу с qr кодами которые можно скачать по одному или архивом все сразу.
Имена файлов должны быть по номерам столов.
В каждом qr коде должна быть прописана ссылка на страницу меню заведения и передан номер стола в качестве переменной.
При загрузке модератором изображения в центре плашки с кодом должно быть это изображение.


Раздел замены шаблонов
В данном разделе модератор может выбрать из вариантов доступных шаблонов для меню заведения. Предварительно посмотреть шаблон и при необходимости поменять и настроить его для своего меню.


Раздел статистики на главном экране
Отображается на главном экране рабочей области модератора в ней отображается
Необходимо срочно заполнить!
Медианный чек без работы системы
Медианный чек с работой системы
Процент улучшения
Медиана блюд в заказе без системы
Медиана блюд в заказе с системой
Процент улучшения
Медиана средней конверсии карточек без
Медиана средней конверсии карточек с
Рекомендации
Количество показов меню
Количество тестов
Количество фичей в шаблоне
Количество чеков
Рейтинг блюд
Самые интересные
Антирейтинг блюд
Блюда которые лучше заменить
Блюда которые необходимо добавить
Коэффициент возврата


СRM 
Таблица собранных контактных данных пользователей


Раздел профиль организации
В нем указывается информация об органтзации


Раздел и система оплаты сервиса
Необходимо реализовать и подключить систему приема платежей. Которая будет уведомлять пользователя о необходимости пополнить счёт.


Кнопка Сделать заказ
При нажатии на кнопку сделать заказ необходимо произвести отправку сообщения через меседжер вотсап с составом заказа и номером столик, а также сохранить номер отправителя в таблицу CRM
Типы пользователей
В сервисе есть два типа пользователей: модераторы и обычные пользователи. 
Модераторы это владельцы предприятий общественного питания которые являются клиентами сервиса. Для работы в сервисе модератор должен пройти регистрацию и завести учётную запись предприятия питания и пройти авторизацию.
Модератор создаёт меню путем добавления в него блюд и категорий блюд.
Также модератор заполняет все данные требующиеся для корректной работы.
Для модераторов доступна рабочая область для редактировани мобильного меню и заполнения необходимой информации.
Пользователи это не авторизованные посетители переходящие на страницу по прямой ссылке через qr код отсканированный за столиком заведения. Ссылка индивидуальна для каждого стола заведения чтобы персонал знал к какому столу привязан заказ.















Функция учета событий
Действия пользователя и взаимодействие с интерфейсом логируютсы и сохраняются в сессии. Сохранение сессии в бд осуществляется функцие сохранения данных. Список логируемых дествий:

Переход по ссылке в карточку товара (учет типа действия и id блюда)
Дата и время перехода
Количество просмотренных страниц
Список просмотренных карточек
Количество просмотренных карточек
Добавление блюда в корзину (учет типа действия и id блюда) 
Дата и время добавления
Количество добавленного товара
Идентификатор сессии пользователя
Цена за единицу
Выборка (ТВ/КВ)
Номер тестового прохода
Дата и время начала сессии
Дата и время последнего события сессии

 
Функция тестирования
Осуществляет постоянное а/б тестирования при каждом показе экрана сервиса. Тестирование по разным сценариям может проходить параллельно.
При тестировании показы разбиваются на две выборки тестовую (ТВ) и контрольную (КВ). ТВ вносит изменения в шаблон тестируемого элемента страницы которые мы называем фича. 
Тест длится до достижение заданного количества показов, которое указывается для каждого алгоритма отдельно в таблице Feature.
Особенность внедрения фитчи в карточки блюд заключается в ее применении к определенной выборки карточек. Выборка задается ORM запросом конкретной фитчи и хранится в таблице Feature. Выборка применения фитчи может содержать и все карточки.
Функция тестирования делит пользователей на две выборки тестовую (ТВ) и контрольную (КВ). Пользователям тестовой выборки система показывает фитчу а контрольной нет.
Итогом тестирования каждого пользовательского сеанса является вызов функции сохранения. 
После достижения заданного количества тестовых сеансов вызывается функция подсчёта.
Необходимо понимать что таблицы: Basket, FeatureTest в ТЗ приведены в разделах к которым они имеют логическое отношение, но добавление данных в них происходит при срабатывании функции сохранения.  Т.е. функция тестирования сама не сохраняет данные в таблицу и принудительно не вызывает функцию сохранения, а ждет пока наступит сценарий и сработает функция сохранения.

Кеширование выборок
Важно обеспечить кеширование и тестовой и контрольной выборки отдельно и прописать их корректную последовательную выдачу согласно алгоритму тестирования.




Функция Сохранение данных
Система собирает большое количество данных о поведении пользователя что создаст неприемлемую нагрузку на базу данных при их постоянном добавлении.  Для оптимизации нагрузки на БД система должна хранить необходимые события, данные о действиях пользователя не в базе данных а в сессии. Сохранение данных из сессии в базу производится в случае:
Закрытия страницы приложения
Закрытии сессии
Выхода со страницы приложения
Через заданный времяной интервал бездействия пользователя
Нажатии кнопки сделать заказ
Система сохраняет данные из сессии в таблицы Basket, FeatureTest и Dishe

Таблица Basket (хранится каждое блюдо заказа)
Блюдо dishe связанное поле с таблицей Dishe с id блюда
Количество quantity количество в заказе
Дата и время добавления заполняется автоматически
Идентификатор сессии пользователя который добавил блюдо
Цена за единицу


Таблица FeatureTest (общие данные по заказу)
id_feature поле связанное с таблицей Feature связь один ко многим
id_basket поле связанное с таблицей basket один ко многим
Выборка (ТВ/КВ) - вносится 1 если ТВ и 0 если КВ
Переходов - количество переходов в карточки выборки
Покупок - количество покупок с карточки выборки
Кол-во товаров - вносится количество товаров выборки в корзине
Общий чек выборки - сумма всех покупок с карточек выборки
Дата и время заполняется автоматически
Номер тестового прохода - номер прохода выборки

Таблицу Dishe
Показы
Переходы
Покупки























Функция расчета
Вызывается функцией тестирования после достижения необходимого количества тестовых показов. Проверяет добавленные новые позиции в таблицы  FeatureTest и добавленные данные в таблицу Dishe и рассчитывает производные позиции в таблтцах Feature и Dishe.


Таблица Feature (статистика по фитче)
Название title (заполняет администратор при создании)
Тестовый элемент – выбрать элемент в который вносится фитча (главная страница, карточка блюда, страница блюда, корзина) 
Поле фитчи – изменяемое поле либо таблица с результатами 
изменения. Необходимо выбрать тестируемую колонку в таблице (главная страница - Place; карточка блюда, страница блюда Dishe, корзина Basket)
ORM запрос выборки для карточек
Количество показов тестовой выборки - (заполняется администратором при создании)
Используют place_count количество организаций использующих фитчу(заполняет функция сравнения)
Рейтинг фичи raiting заполняется функцией сравнения
Дата и время внедрения заполнляется автоматически при создании администратором
Средний чек ТВ: Медиана всех чеков выборки
Средний чек КВ: Медиана всех чеков выборки
Медиана количества товаров в чеке ТВ: Медиана товаров в выборке
Медиана количества товаров в чеке КВ: Медиана товаров в выборке
Глубина просмотра ТВ: количество просмотренных страниц/карточек
Глубина просмотра КВ: количество просмотренных страниц/карточек
Конверсия ТВ: общее количество целевых действия на сайте
Конверсия КВ: общее количество целевых действия на сайте
Время сеанса ТВ: время между заходом на страницу и последней активностью
Время сеанса КВ: время между заходом на страницу и последней активностью
Показы ТВ: количество показов было у элементов выборки
Показы КВ: количество показов было у элементов выборки
Данные позиции заполняются для карточек
Конверсия покупки ТВ: Покупки/Показы
Конверсия покупки КВ: Покупки/Показы
Медиана количества позиции в чеке ТВ конкретной карточки
Медиана количества позиции в чеке КВ конкретной карточки
Конверсия перехода ТВ: Переход/ Показы
Конверсия перехода КВ: Переход/ Показы
Позиция максимального чека ТВ: Вероятность покупки * цену
Позиция максимального чека КВ: Вероятность покупки * цену
Позиция максимальной прибыли КВ: Вероятность покупки * цену * маржу
Позиция максимальной прибыли ТВ: Вероятность покупки * цену * маржу
Клики ТВ: количество кликов по элементу
Клики КВ: количество кликов по элементу
Частота показа ТВ: средняя частота показа элемента пользователю за сессию
Частота показа КВ: средняя частота показа элемента пользователю за сессию







Рейтинг фитчи считается по формуле 
Медиана количества товаров в чеке/Медиана переходов/Медиана покупок/
Медианный чек выборки сравнивает эти четыре показателя ТВ и КВ и если ТВ больше прибавляет к рейтингу +1 балл по каждой позиции сравнения (из 4-х) + средний процент повышения чека + 0.1 за каждую организацию использующую фичу в шаблоне.
Средний процент повышения метрики - рассчитывается по формуле
ТВ/КВ*100-100
Результаты всех тестов заносятся в таблицу Feature. Администратор системы смотрит на результаты и принимает решение о том будет ли фитча добавлена в список внедрения организации. Для того чтобы фитча была добавлена администратор помечает ее как активную в таблице Feature.

Порядок внедрения
Есть фитчи которые предустановлены в шаблон новых пользователей.
Остальные фитчи добавляются в шаблон пользователя с заданным интервалом времени в порядке рейтинга. Интервал внедрения задается администратором в таблице Feature. 



Функция внедрения
Фича добавляется через выборку полей в запросе в ORM Django.
Для каждого заведения должна быть свой ORM запрос со списком полей используемых в запросе исходя из пройденных тестов.
Этот запрос предположительно можно хранить в виде строки в таблице Place он будет называться шаблон заведения.
Также требуется каждый раз формировать тестовый шаблон который будет содержать дополнительную строку подающуюся на тест.


Шаблон заведения 
Каждое заведение имеет свой уникальный шаблон которые настраивается путем тестирования под аудиторию заведения. Хранится отдельной графой в таблице Place.
 
Добавление фичей
При создании новых фитчей поля ее переменных добавляются в таблицы в которых они будут отображаться или создаются отдельные связанные таблицы. Добавление фитчей доступно только администратору.
Если фитча использует лигику она прописывается в отдельном файле.
Данные о новой фитче заносятся через админку в таблицу Feature.

При добавлении новой фитчи в таблицу Feature необходимо заполнить:

Таблица Feature (статистика фитчей)
Название title (заполняет администратор при создании)
Тестовый элемент – выбрать элемент в который вносится фитча. (главная страница, карточка блюда, страница блюда, корзина) 
Поле фитчи – изменяемое поле либо таблица с результатами 
изменения. Необходимо выбрать тестируемую колонку в таблице (главная страница- Place; карточка блюда, страница блюда Dishe, корзина Basket)
ORM запрос выборки для карточек
Количество показов тестовой выборки - (заполняется администратором при создании)

Метрики
Для большей точности все показатели должны рассчитываться по времени к примеру у нас есть три временных интервала в которых необходимо формировать три отдельных меню и соответственно три сортировки и три рейтинга так как в данные интервалы пользователи приходят за разным и выбирают разные блюда и смешивать их не правильно.

Времяные интервалы
Утро/день/вечер

Метрики Товара
Метрики Заведения

Средний чек: Медиана всех чеков выборки
Медиана количества товаров в чеке: Медиана товаров в выборке
Глубина просмотра сессии: количество просмотренных страниц (переходов)
Глубина просмотра странтцы количество карточек просмотренных на странице
Конверсия: общее количество целевых действия на сайте
Время сеанса: время между заходом на страницу и последней активностью
Показы: количество показов было у элемента
Конверсия покупки: Покупки/Показы
Медиана количества позиции в чеке
Конверсия перехода: Переход/ Показы
Позиция максимального чека: Вероятность покупки * цену
Позиция максимальной прибыли: Вероятность покупки * цену * маржу
Клики: количество кликов по элементу
Частота показа: средняя частота показа элемента пользователю за сессию
Переход в карточку блюда
Добавление в корзину
Количество позиции в чеке
Количество визитов пользователя
Вероятность покупки блюда
Покупки/Показы
Вероятность перехода
Переход/ Показы
Максимальный чек
Вероятность покупки * цену
Максимальная прибыль
Вероятность покупки * цену * маржу
Чек категории  более чувствителен чем средний чек
Чек карточки более чувствителен чем средний чек
Время на странице показатель лояльности пользователя


Список фитчей

Карточка блюда таблица Dishe

1.	Сортировка все блюда по умолчанию сортируются по категориям эта фитча делает вторую сортировку уже внутри категорий по полям таблицы Dishe 
2.	Цена со скидкой (задается размер скидки) при заполнении скидки отображается новая цена со скидкой и старая цена зачеркнута
3.	Вес блюда (отображается и нет)
4.	Маленькие картинки в карточке товара (отображаются или нет и возможность задать для каждого блюда одну или несколько картинок)
5.	Подбор оптимальной картинки (прикрепляем к блюду несколько картинок и тест считает у какой конверсия лучше перебирая их)
6.	плашка акции накладывается на фото
7.	плашка призыв к действию накладывается под фото
8.	плашка скидка накладывается на фото под полашку акции




Странице блюда таблица Dishe

Возможность использовать в разделе блюд все фитчи что были перечислены выше и дополнительные которые указаны в этом разделе
1.	добавление в блюдо дополнительных ингредиентов (выводит список добавок и чек бокс для выбора) список добавок к блюду задается модератором в админке (апсейл)
2.	выбор большего размера и веса блюда (идеально три размера чтобы пользователь всегда выбирал средний размер.
3.	список похожих блюд ниже описания (пользователь сможет продолжить выбор блюд без дополнительных переходов)
4.	описание (есть или нет)
5.	белки жиры углеводы (отображаются или не отображаются)
6.	вес блюда (отображается или не отображается)
7.	Создание и изменение подложки для изображений блюд для выбора самой продающей


Раздел категории таблица Category
Категории необходимо рассматривать как полки в магазине или предложения для пользователя. Категории задают порядок предложений он должен отталкиваться от времени утро, день, вечер (ночь). 
Для каждого временного диапазона должен быть свой порядок сортировки.
Технически это реализуется за счет создания трех граф в которых будет распределены позиции сортировки категорий в каждом временном интервале.
1.	сортировка категорий по временным интервалам
2.	первая категория спец предложений (комбо) с топ товарами 2-4 штуки (показывая топ товары мы увеличиваем вероятность их выбора)
3.	введение в меню 1-2 новых категории (категория рассматривается с позиции призыва к действию, предложения гостю) 

Главная страница таблица Place

1.	Изображение заведения*
2.	Лента категорий закрепленных в шапке страницы*
3.	Главное меню – карусель под банером изображения
4.	Плашка спец предложение под фото заведения
5.	Рекламный банер между категорий в ленте
6.	Карусель акций заведения под фото заведения
7.	Большой банер первого и последнего блюда
8.	В шапке сайта и в карусели раздел страница заведения
9.	Банер на весь экран при первой загрузке главной страницы с предложением единорога

Корзина таблица Basket

1.	Пожелание к заказу переводит в телеграмм и мы получаем контакты
2.	Кнопка сделать заказ переводит в меседжеры и мы получаем контакт посетителя
3.	список похожих блюд (выводится внизу страницы и отображает всю ленту блюд заведения которую пользователь еще не листал


Шаблон заведения таблица Place
1.	Настройка цветовой схемы
2.	Количество колонок в меню от одной до трех
 

